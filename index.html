<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grammar Checker - Allen ISD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .error-highlight {
            background-color: #fecaca;
            border-bottom: 2px solid #ef4444;
            cursor: pointer;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100" onload="init()">
    <div class="max-w-6xl mx-auto p-4">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">üìö Grammar Checker</h1>
                    <p class="text-gray-600 text-sm">Writing assistant for students</p>
                </div>
                <div class="flex gap-4 text-sm">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-indigo-600" id="word-count">0</div>
                        <div class="text-gray-600">Words</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-indigo-600" id="sentence-count">0</div>
                        <div class="text-gray-600">Sentences</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-indigo-600" id="char-count">0</div>
                        <div class="text-gray-600">Characters</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Text Editor -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-gray-800">Your Text</h2>
                        <div class="flex gap-2">
                            <button id="check-btn" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-medium transition">
                                Check Now
                            </button>
                            <button id="clear-btn" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg text-sm font-medium transition">
                                Clear
                            </button>
                        </div>
                    </div>
                    
                    <textarea
                        id="text-input"
                        placeholder="Start typing or paste your text here, then click 'Check Now'..."
                        class="w-full h-96 p-4 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none resize-none font-mono text-gray-800"
                    ></textarea>

                    <div id="preview-section" style="display:none;" class="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200 min-h-[100px]">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">Preview with highlights:</h3>
                        <div id="preview-text" class="text-gray-800 whitespace-pre-wrap font-mono text-sm leading-relaxed"></div>
                    </div>
                </div>
            </div>

            <!-- Suggestions Panel -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-lg p-6 sticky top-4">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">
                        <span id="error-status">‚úÖ No Issues Found</span>
                    </h2>

                    <div id="suggestions-list" class="space-y-3 max-h-[600px] overflow-y-auto">
                        <div class="text-center py-8 text-gray-500">
                            <div class="text-4xl mb-2">‚úÖ</div>
                            <p>Type text and click "Check Now"</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Footer -->
        <div class="mt-6 bg-white rounded-lg shadow-lg p-4 text-center text-sm text-gray-600">
            <p>üîí All checking happens in your browser. No data is sent anywhere.</p>
        </div>
    </div>

    <script>
        var currentErrors = [];

        function init() {
            document.getElementById('check-btn').onclick = checkNow;
            document.getElementById('clear-btn').onclick = clearText;
            document.getElementById('text-input').oninput = function() {
                calculateStats(this.value);
            };
        }

        function checkGrammar(text) {
            var errors = [];
            
            // Sentence capitalization
            var sentences = text.match(/[^.!?]+[.!?]+/g) || [text];
            var currentIndex = 0;
            
            for (var s = 0; s < sentences.length; s++) {
                var sentence = sentences[s];
                var trimmed = sentence.trim();
                if (trimmed.length > 0 && /^[a-z]/.test(trimmed)) {
                    var actualIndex = text.indexOf(trimmed, currentIndex);
                    if (actualIndex !== -1) {
                        errors.push({
                            index: actualIndex,
                            length: 1,
                            original: trimmed.charAt(0),
                            suggestion: trimmed.charAt(0).toUpperCase(),
                            reason: "Capitalize first letter of sentence",
                            type: 'capitalization'
                        });
                    }
                }
                currentIndex += sentence.length;
            }

            // Check pronoun I
            var iRegex = /\bi\b/g;
            var match;
            while ((match = iRegex.exec(text)) !== null) {
                errors.push({
                    index: match.index,
                    length: 1,
                    original: 'i',
                    suggestion: 'I',
                    reason: "Always capitalize 'I'",
                    type: 'capitalization'
                });
            }

            // Check contractions
            var contractions = {
                'cant': "can't", 'wont': "won't", 'dont': "don't",
                'doesnt': "doesn't", 'didnt': "didn't", 'isnt': "isn't",
                'arent': "aren't", 'wasnt': "wasn't", 'werent': "weren't",
                'havent': "haven't", 'hasnt': "hasn't", 'hadnt': "hadn't",
                'wouldnt': "wouldn't", 'couldnt': "couldn't", 'shouldnt': "shouldn't"
            };
            
            for (var wrong in contractions) {
                var regex = new RegExp('\\b' + wrong + '\\b', 'gi');
                while ((match = regex.exec(text)) !== null) {
                    errors.push({
                        index: match.index,
                        length: match[0].length,
                        original: match[0],
                        suggestion: contractions[wrong],
                        reason: "Missing apostrophe",
                        type: 'spelling'
                    });
                }
            }

            // Check common misspellings
            var misspellings = {
                'alot': 'a lot',
                'recieve': 'receive',
                'wierd': 'weird',
                'occured': 'occurred',
                'seperate': 'separate',
                'definately': 'definitely',
                'goverment': 'government',
                'enviroment': 'environment',
                'tommorow': 'tomorrow'
            };
            
            for (var wrong in misspellings) {
                var regex = new RegExp('\\b' + wrong + '\\b', 'gi');
                while ((match = regex.exec(text)) !== null) {
                    errors.push({
                        index: match.index,
                        length: match[0].length,
                        original: match[0],
                        suggestion: misspellings[wrong],
                        reason: "Common spelling error",
                        type: 'spelling'
                    });
                }
            }

            // Check repeated words
            var repeatRegex = /\b(\w+)\s+\1\b/gi;
            while ((match = repeatRegex.exec(text)) !== null) {
                errors.push({
                    index: match.index,
                    length: match[0].length,
                    original: match[0],
                    suggestion: match[1],
                    reason: "Repeated word",
                    type: 'style'
                });
            }

            // Check double spaces
            var spaceRegex = /\s{2,}/g;
            while ((match = spaceRegex.exec(text)) !== null) {
                errors.push({
                    index: match.index,
                    length: match[0].length,
                    original: match[0],
                    suggestion: ' ',
                    reason: "Extra spaces",
                    type: 'spacing'
                });
            }

            errors.sort(function(a, b) { return a.index - b.index; });
            return errors;
        }

        function calculateStats(text) {
            var words = text.trim() ? text.trim().split(/\s+/).length : 0;
            var sentences = text.split(/[.!?]+/).filter(function(s) { return s.trim().length > 0; }).length;
            var characters = text.length;
            
            document.getElementById('word-count').textContent = words;
            document.getElementById('sentence-count').textContent = sentences;
            document.getElementById('char-count').textContent = characters;
        }

        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function updatePreview(text, errors) {
            var previewSection = document.getElementById('preview-section');
            var previewText = document.getElementById('preview-text');
            
            if (text === '' || errors.length === 0) {
                previewSection.style.display = 'none';
                return;
            }
            
            previewSection.style.display = 'block';
            
            var result = '';
            var lastIndex = 0;
            
            for (var i = 0; i < errors.length; i++) {
                var error = errors[i];
                result += escapeHtml(text.substring(lastIndex, error.index));
                result += '<span class="error-highlight" title="' + escapeHtml(error.reason) + '">' + 
                          escapeHtml(text.substring(error.index, error.index + error.length)) + '</span>';
                lastIndex = error.index + error.length;
            }
            result += escapeHtml(text.substring(lastIndex));
            
            previewText.innerHTML = result;
        }

        function updateSuggestions(errors) {
            var errorStatus = document.getElementById('error-status');
            var suggestionsList = document.getElementById('suggestions-list');
            
            if (errors.length === 0) {
                errorStatus.textContent = '‚úÖ No Issues Found';
                suggestionsList.innerHTML = '<div class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">‚úÖ</div><p>Your text looks great!</p></div>';
            } else {
                errorStatus.textContent = '‚ö†Ô∏è ' + errors.length + ' Issue' + (errors.length !== 1 ? 's' : '') + ' Found';
                
                var html = '';
                for (var i = 0; i < errors.length; i++) {
                    var error = errors[i];
                    html += '<div class="p-4 bg-red-50 border border-red-200 rounded-lg">';
                    html += '<div class="mb-2"><span class="px-2 py-1 bg-red-200 text-red-800 text-xs font-semibold rounded uppercase">' + error.type + '</span></div>';
                    html += '<div class="mb-2"><span class="text-sm text-gray-600">Found: </span>';
                    html += '<span class="font-mono bg-white px-2 py-1 rounded border text-sm">' + escapeHtml(error.original) + '</span></div>';
                    html += '<div class="mb-2"><span class="text-sm text-gray-600">Suggestion: </span>';
                    html += '<span class="font-mono bg-green-50 px-2 py-1 rounded border border-green-300 text-sm">' + escapeHtml(error.suggestion) + '</span></div>';
                    html += '<p class="text-sm text-gray-700 mb-3">' + escapeHtml(error.reason) + '</p>';
                    html += '<button onclick="applySuggestion(' + i + ')" class="w-full px-3 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-medium transition">Apply Fix</button>';
                    html += '</div>';
                }
                suggestionsList.innerHTML = html;
            }
        }

        function applySuggestion(errorIdx) {
            var error = currentErrors[errorIdx];
            var textInput = document.getElementById('text-input');
            var text = textInput.value;
            
            var newText = text.substring(0, error.index) + error.suggestion + text.substring(error.index + error.length);
            textInput.value = newText;
            
            checkNow();
        }

        function checkNow() {
            var text = document.getElementById('text-input').value;
            if (!text.trim()) {
                currentErrors = [];
                updatePreview('', []);
                updateSuggestions([]);
                return;
            }
            
            currentErrors = checkGrammar(text);
            calculateStats(text);
            updatePreview(text, currentErrors);
            updateSuggestions(currentErrors);
        }

        function clearText() {
            document.getElementById('text-input').value = '';
            currentErrors = [];
            updatePreview('', []);
            updateSuggestions([]);
            calculateStats('');
        }
    </script>
</body>
</html>
